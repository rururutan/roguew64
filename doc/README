
		データ分離版ローグ・クローンII

○はじめに

  このゲームは (株) リコー ソフトウェア事業部の太田 純 さんによる、
『ローグ・クローン２日本語版 １．３』をもとに、プログラムとデータを分
離したものです。ゲーム自体はオリジナルのものと、ほとんど変わりありませ
ん。

  このプログラムは、メッセージを好きなように変えた「ローグ」をリコンパ
イルせずに作るために、メッセージとプログラムを分離したものです。


○ゲームの仕方

  このゲームはデータが分離しているので、そのファイル名を引数として与え
る必要があります。

	例: rogue mesg

  その他、オプション -s (スコアを見る) あるいはセーブファイルの指定な
どは、メッセージファイルの後に与えます。

	例: rogue mesg -s
	    rogue mesg savedfile


○著作権について

  このプログラムは、ソース、実行ファイルを含めてコピーフリーで、利用・
改変・再配布は自由に行なうことが出来ます。

  このプログラムは、Tim Stoehr による英語版の Rogue-clone: Version II
を太田 純さんが日本語化して MS-DOS に移植したものを私が UNIX 向けのデ
バッグとメッセージの分離を行なったものです。

  Tim Stothr と私は著作権を放棄していますので、日本語版の著作権、著作
者人格権は太田 純さんが所有しています。太田 純さんが関わっていない部分
(README.doc 参照) は、完全な PDS です。

  著作権に関する詳細は、太田 純さんの書いたドキュメント README.doc を
参照してください。


○コンパイルするには

・UNIX 環境では次の環境での動作を確認しています。

	SunOS 4.1.1	(Sun Sparc Station 1)		gcc
	UniOS-B		(OMRON LUNA)			cc, gcc
	NeXT step 2.1J	(NeXT Cube Monochrome 68030)	cc, gcc
	386BSD		(NEC PC-9801DA)			gcc

  Makefile.nix の適当な部分を使ってコンパイルして下さい。

    * Sparc の cc など、
	(condition) ? "文字列定数1" : "文字列定数2"
      を通さないコンパイラでは、このままではコンパイルできません。

    * machdep.c で ioctl() を用いているので、環境によっては
      traditional の cpp を用いる必要があります。
      gcc 2.0 以上では、デフォルトで ANSI 準拠ですから気をつけて下さい。

    * System V は あまりテストしていません。若干ライブラリの関数名が違
      うかもしれません。

    * System V の terminfo には対応していません。termcap を
      シミュレートして下さい。


・MS-DOS 上で使うには、まず *.c, mesg* を Shift-JIS に変換して下さい。

	Microsoft C
	Borland C

  上での動作を確認しました。
    処理系がないので確認できませんが、 Lattice-C でもコンパイルできる
  かもしれません(オリジナルではできるそうです)。

    Shift-JIS コードを通すコンパイラを使って下さい。
    データエリアが大きいので Huge モデルでコンパイルして下さい。
  Makefile.tcc は直してありません。
    #if のネストを許さないようなコンパイラではもはやコンパイルできない
  はずです。
    主記憶が少ないマシンでは、コンパイル・実行が出来ないことがあります。
  make を使っていると最後のリンクだけ出来ないということもあります。
    関数宣言などの問題で、若干の修正が必要なことがあります。

    附属の BATCHCOM.COM (batchcom.uue) はなぜか動作しませんので、適当
  に INSTALL.BAT (install.uue) を書き換えてMakefileを生成して下さい。
    くわしくは、太田 純さんの書いたドキュメント README.doc を参照して
  ください。


・Human 68k (X68000) 上で使うには、まず *.c, mesg* を Shift-JIS に変換
  して下さい。

	gcc + XC のライブラリ

  での動作を確認しています。XC でコンパイルできるかどうかは、KMC では
  もはや XC はインストールされていないので確認できません。


  ◇コンパイラオプション
	-DUNIX		すべての UNIX システム。

	-DUNIX_BSD4_2	4.2BSD 以降(4.1も?)。

	-DUNIX_386BSD	fpurge(FILE *stream) (バッファの内容を捨てる)
			のあるシステム。
			386BSD では、FILE 構造体が変わっていて、
			ふつうの flush ができない。
			-DUNIX, -DUNIX_BSD4_2 は必要。

	-DUNIX_SYSV	System Vのとき。
			-DCURSES のときには BSD 相当の termcap が必要。

	-DMSDOS		MS-DOS, Human 68k のとき。

	-DHUMAN		Human 68k のとき。
			-DMSDOS が必要。

	-DCURSES	附属の curses を使う。これがないときには
			システムの curses ライブラリを使う。

	-DCOLOR		カラーにする。
			-DCURSES をつけて附属の curses を使う必要がある。
			UNIX 上では出来ない(と思う)。

	-DJAPAN		日本語モードにする。
			NeXT 以外は -DCURSES が必要。(?)
			NeXT はどちらでも良い。

	-DEUC		漢字コードを UNIX JIS にする。
			これをつけないと Shift-JIS とになる。
			-DJAPAN がないときには無意味。

	-DTOPSCO	最高得点に同一の人が複数載るようにする。
			これをつけないとその人の最高のものしか載らない。
			この有無によってメッセージファイルの 187 番目
			の記述を変える必要がある。

	-DORIGINAL	Tim Stothr によるオリジナルをコンパイルする。
			もうこれをつけてコンパイルすることが
			出来なくなってしまいました (;_:)。


○ローグ・クローン２　日本語版１．３からの変更点

・メッセージを分離し、プログラム起動時の第１引数で与えられるファイルから
読み込むようにました。

  メッセージファイルの構造は、

	メッセージ番号		"メッセージ"

で、このフォーマット以外の部分はすべてコメントとして読み飛ばされます。
  必要なメッセージが抜けていると暴走しますので注意して下さい。漢字を
使う場合は、コードは -DEUC が指定されているときには UNIX JIS、そうで
ないときはShift-JIS である必要があります。コントロールコードのような、
バイト数と表示される長さが異なってくるようなものは使えません。また、
 " (２重引用符) を含めることもできません。

・UNIX の termcap を次のように解釈するようにしました。
  1) 環境変数 TERMCAP にtermcap エントリを指定する、
  または
  2) TERM に端末のタイプを指定し、TERMCAP に termcap ファイル名を指定す
     る(この場合は TERMCAP の指定がなければ /etc/termcap とみなされる)。

・ソースの #if defined(JAPAN) && !defined(CURSES) という所は、NeXTを
  想定しています。

・指輪と食糧の減り方の関係がおかしいというバグを直しました。

・プレイヤーの名前として、環境変数 FIGHTER の値が USER の値に優先する
  ようにしてあります。


○バグ

・NeXT の jcurses を使ってコンパイルすると、画面ダンプ (Control-D) で、
  漢字がおかしくなります。これは jcurses から得られる画面情報の最上位ビ
  ットがおかしいからです。save game コマンド(S) では対策をしてあります。

・termcap の解釈で、同じエントリがあると最後のものが有効になります(本当
  は tc= エントリがあることを考えて、最初ものが有効になるのが望ましい)。
  また、@ (そのエントリが存在しないことを示す) は何もないのと同じです。

・Sparc (kterm / X11R4) 上で、最上部の表示がおかしくなることがあります。
  ［続く］等が残ってしまうというものです。kterm のバグかもしれませんが。

・playmenu.c はそのままでは動かないはずです。使っていないので直してあ
  りません。元のままのソースです。rogue.exe にメッセージファイル名の
  引数を与えるようにすればば動くと思います。

---------------------------------------------------------------------------
							Sept. 10, 1992
						     京大マイコンクラブ
						伊藤 康史 (Ito Yasufumi)
						  brx@kmc.kyoto-u.ac.jp
